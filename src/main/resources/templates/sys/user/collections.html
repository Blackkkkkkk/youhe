<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
      xmlns:shiro="http://www.w3.org/1999/xhtml">
<head th:include="common/Head :: headCss">

</head>
<div>
    <link rel="stylesheet" href="../bootstrap/js/dept/css/bootstrap-table.min.css">
    <link rel="stylesheet" href="../bootstrap/js/dept/css/jquery.treegrid.css">
    <link rel="stylesheet" href="../ztree/css/metroStyle/metroStyle.css">
    <link rel="stylesheet" href="../ztree/css/metroStyle/metroStyle.css">
</div>
<body>
<div id="wrapper">
    <nav th:include="common/Left_Ment :: left"></nav>
    <div id="page-wrapper" class="gray-bg dashbard-1">
        <div th:include="common/Head :: head"></div>
        <!--<div v-show="showList">-->
            <!--<div class="grid-btn">-->
                <!--<a class="btn btn-primary" @click="add"><i class="fa fa-plus"></i>&nbsp;新增</a>-->
                <!--<a class="btn btn-primary" @click="update"><i class="fa fa-pencil-square-o"></i>&nbsp;修改</a>-->
                <!--<a class="btn btn-primary" @click="del"><i class="fa fa-trash-o"></i>&nbsp;删除</a>-->
            <!--</div>-->
            <!--<table id="deptTable" data-mobile-responsive="true" data-click-to-select="true">-->
                <!--<thead>-->
                <!--<tr>-->
                    <!--<th data-field="selectItem" data-checkbox="true"></th>-->
                <!--</tr>-->
                <!--</thead>-->
            <!--</table>-->
        <!--</div>-->
        <div v-show="!showList" class="panel panel-default">
            <div class="panel-heading">收藏书签</div>
            <form class="form-horizontal" id="myForm" >
                <div class="form-group">
                    <div class="col-sm-10">
                        <input type="hidden"  class="form-control"  name="userAccount"
                               id="userAccount"
                               placeholder="登录账号" style="width: 8cm" />
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-2 control-label"><a>收藏标签：</a></div>

                </div>
                <!--<div class="form-group">-->
                    <!--<div class="col-sm-2 control-label">手机号码</div>-->
                    <!--&lt;!&ndash;<div class="col-sm-10">&ndash;&gt;-->
                        <!--&lt;!&ndash;<input type="text" class="form-control"  th:value="${collectionList.url}" placeholder="手机" style="width: 8cm" name="phone"/>&ndash;&gt;-->
                    <!--&lt;!&ndash;</div>&ndash;&gt;-->
                <!--</div>-->

                <div class="form-group" th:each="lists:${collectionList}">

                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <a  class="glyphicon glyphicon-star"></a>&nbsp;&nbsp;&nbsp;
                        <!--<a  th:href="${lists.url}"  target="_blank"><a  th:text="${lists.url}" > </a></a>-->
                        <a  th:href="${lists.url}" ><span class="nav-label"  th:text="${lists.url}"></span></a>
                    </div>
                </div>

                <!--<div class="form-group">-->
                    <!--<div class="col-sm-2 control-label">注册时间</div>-->
                    <!--<div class="col-sm-10">-->
                        <!--<input type="text" class="form-control"  th:value="${user.registerDate}" placeholder="手机" style="width: 8cm" readonly />-->

                    <!--</div>-->
                <!--</div>-->
                <!--<div class="form-group">-->
                    <!--<div class="col-sm-2 control-label">排序</div>-->
                    <!--<div class="col-sm-10">-->
                        <!--<input type="text" class="form-control"  th:value="${user.orderNum}" placeholder="手机" style="width: 8cm" readonly/>-->
                    <!--</div>-->
                <!--</div>-->

            </form>
        </div>
    </div>
    <!-- 选择角色 -->
    <div id="roleLayer" style="display: none;padding:10px;">
        <div class="wrapper">
            <div class="treeShowHideButton" onclick="search();">
                <label id="btnShow" title="显示搜索" style="display:none;">︾</label>
                <label id="btnHide" title="隐藏搜索">︽</label>
            </div>
            <div class="treeSearchInput" id="search">
                <label for="keyword">关键字：</label><input type="text" class="empty" id="keyword" maxlength="50">
                <button class="btn" id="btn" onclick="searchNode()"> 搜索</button>
            </div>
            <div class="treeExpandCollapse">
                <a href="javascript:" id="btnExpand">展开</a> /
                <a href="javascript:" id="btnCollapse">折叠</a>
            </div>
            <div id="roleTree" class="ztree"></div>
        </div>
    </div>

    <!-- 选择部门 -->

    <div id="deptLayer" style="display: none;padding:10px;">
        <div class="wrapper">
            <div class="treeShowHideButton" onclick="search();">
                <label id="btnShowDept" title="显示搜索" style="display:none;">︾</label>
                <label id="btnHideDept" title="隐藏搜索">︽</label>
            </div>
            <div class="treeSearchInput" id="search1">
                <label for="keyword">关键字：</label><input type="text" class="empty" id="keywordDept" maxlength="50">
                <button class="btn" id="btnDept" onclick="searchDeptNode()"> 搜索</button>
            </div>
            <div class="treeExpandCollapse">
                <a href="javascript:" id="btnExpandDept">展开</a> /
                <a href="javascript:" id="btnCollapseDept">折叠</a>
            </div>
            <div id="deptTree" class="ztree"></div>
        </div>
    </div>


</div>

<div th:include="common/Head :: js"></div>

<script src="../ztree/jquery.ztree.all.min.js"></script>
<script src="../ztree/jquery.ztree.exhide.js"></script>
<script src="../bootstrap/js/dept/js/bootstrapValidator.js"></script>

<script src="../bootstrap/js/dept/js/jquery.treegrid.min.js"></script>
<script src="../bootstrap/js/dept/js/jquery.treegrid.bootstrap3.js"></script>
<script src="../bootstrap/js/dept/js/jquery.treegrid.extension.js"></script>
<script src="../bootstrap/js/dept/js/tree.table.js"></script>

<script src="../bootstrap/js/dept/js/vue.min.js"></script>
<!--<script src="../bootstrap/js/user/js/updateUser.js"></script>-->
<script src="../bootstrap/js/user/js/Roleztree.js"></script>

<script src="../bootstrap/user/plugins/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<script type="text/javascript" src="../bootstrap/user/plugins/jQuery-slimScroll/jquery.slimscroll.min.js"></script>
<script type="text/javascript" src='../bootstrap/user/plugins/zoom/jquery.zoom.min.js'></script><!-- product zoom -->
<script src="../bootstrap/user/plugins/layerslider/jQuery/jquery-easing-1.3.js" type="text/javascript"></script>
<script src="../bootstrap/user/plugins/layerslider/jQuery/jquery-transit-modified.js" type="text/javascript"></script>
<script type="text/javascript" src="../bootstrap/user/plugins/fancybox/source/jquery.fancybox.pack.js"></script>
<script type="text/javascript" src="../bootstrap/user/plugins/bxslider/jquery.bxslider.min.js"></script>
<!-- slider for products -->



<script type="text/javascript">




    var layer;
    $(function () {


    });
    //dept

    var lastValueDept = "", nodeListDept = [], keyDept = $("#keywordDept");
    keyDept.bind("focus", focusKey).bind("blur", blurKey).bind("change cut input propertychange", searchNodeDept);
    keyDept.bind("keydown", function (e) {
        if (e.which == 13) {
            searchNodeDept();
        }
    });


    //确定
    saveOrUpdate=function(obj) {
        var uid = obj.split(',')[0];
        var userName=$("input[name='userName']").val();
        var email=$("input[name='email']").val();
        var phone=$("input[name='phone']").val();
        var bootstrapValidator = $("#myForm").data('bootstrapValidator');
        bootstrapValidator.validate();
        if (bootstrapValidator.isValid()) {
            // console.info(deliveryAddr);

            $.get("/user/updates?userName=" + userName + "&email=" + email + "&phone=" + phone + "&uid=" + uid, function (r) {

                console.info(r);
                if (r.Status == 0) {
                    layer.msg('操作成功', {
                        icon: 1,
                        time: 1000
                    }, function () {
                        closeWindow();
                    });
                    // alert("修改成功");
                    //  closeWindow();
                } else {
                    layer.msg(r.msg, {
                        icon: 2,
                        time: 2000
                    });
                    closeWindow();
                }
            });
        }

    }



//关闭
     function closeWindow() {
        var userAgent = navigator.userAgent;
        if (userAgent.indexOf("Firefox") != -1 || userAgent.indexOf("Chrome") != -1) {
            location.href = "/index";
        } else {
            window.opener = null;
            window.open('', '_self');
        }
        window.close();
    }

    function focusKey(e) {
        if (keyDept.hasClass("empty")) {
            keyDept.removeClass("empty");
        }
    }


    function blurKey(e) {
        if (keyDept.get(0).value === "") {
            keyDept.addClass("empty");
        }
        searchNodeDept(e);
    }

    function searchNodeDept() {

        var value = $.trim(keyDept.get(0).value);

        var keyType = "name";


        if (lastValueDept === value) {


            return;

        }
        lastValueDept = value;


        var nodes = Deptztree.getNodes();

        if (value == "") {

            showAllNode(nodes);
            return;
        }
        hideAllNode(nodes);


        nodeListDept = Deptztree.getNodesByParamFuzzy(keyType, value);


        updateNodes(nodeListDept);
    }


    function hideAllNode(nodes) {
        //var ztree = $.fn.zTree.getZTreeObj("deptTree");
        nodes = Deptztree.transformToArray(nodes);
        for (var i = nodes.length - 1; i >= 0; i--) {
            Deptztree.hideNode(nodes[i]);
        }
    }

    function showAllNode(nodes) {

        nodes = Deptztree.transformToArray(nodes);
        for (var i = nodes.length - 1; i >= 0; i--) {
            if (nodes[i].getParentNode() != null) {
                Deptztree.expandNode(nodes[i], false, false, false, false);
            } else {
                Deptztree.expandNode(nodes[i], true, true, false, false);
            }
            Deptztree.showNode(nodes[i]);
            showAllNode(nodes[i].children);
        }
    }

    function updateNodes(nodeList) {

        Deptztree.showNodes(nodeList);
        for (var i = 0, l = nodeList.length; i < l; i++) {
            var treeNode = nodeList[i];
            showChildren(treeNode);
            showParent(treeNode)
        }
    }

    function showChildren(treeNode) {

        if (treeNode.isParent) {
            for (var idx in treeNode.children) {
                var node = treeNode.children[idx];
                Deptztree.showNode(node);
                showChildren(node);
            }
        }
    }
    function showParent(treeNode) {

        var parentNode;
        while ((parentNode = treeNode.getParentNode()) != null) {
            Deptztree.showNode(parentNode);
            Deptztree.expandNode(parentNode, true, false, false);
            treeNode = parentNode;
        }
    }

    function searchDeptNode($this) {
        $('#searchDept').slideToggle(200);
        $('#btnShowDept').toggle();
        $('#btnHideDept').toggle();
        $('#keywordDept').focus();
    }

    $(function () {


        $("#systemManage").attr("class", "active");
        $("#systemManage_ul").attr("class", "nav nav-second-level collapse in");

        $("#userManage").attr("class", "active");


        $('#btnExpandDept').click(function () {
            Deptztree.expandAll(true);
        });
        $('#btnCollapseDept').click(function () {
            Deptztree.expandAll(false);
        });


        $('form').bootstrapValidator({
            message: 'This value is not valid',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                password: {
                    message: '密码验证失败',
                    validators: {
                        notEmpty: {
                            message: '密码不能为空'
                        },
                        stringLength: {
                            min: 6,
                            max: 18,
                            message: '密码长度必须在6到18位之间'
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_]+$/,
                            message: '密码只能包含大写、小写、数字和下划线'
                        }
                    }
                },
                passwordAgin: {
                    message: '密码验证失败',
                    validators: {
                        notEmpty: {
                            message: '密码不能为空'
                        },
                        stringLength: {
                            min: 6,
                            max: 18,
                            message: '密码长度必须在6到18位之间'
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_]+$/,
                            message: '密码只能包含大写、小写、数字和下划线'
                        }, callback: {
                            message: '两次密码输入不一致！',
                            callback: function (value, validator, $form) {
                                var password = $("#password").val();

                                if (password == value) {
                                    return true;
                                } else {
                                    return false;
                                }


                            }
                        }
                    }
                },
                // userName: {
                //     message: '用户名验证失败',
                //     validators: {
                //         notEmpty: {
                //             message: '用户名不能为空'
                //         },
                //         stringLength: {
                //             min: 6,
                //             max: 18,
                //             message: '用户名长度必须在6到18位之间'
                //         }
                //     }
                // },
                email: {
                    validators: {
                        notEmpty: {
                            message: '邮箱不能为空'
                        },
                        emailAddress: {
                            message: '邮箱地址格式有误'
                        }
                    }
                },
                phone: {
                    message: '手机号码验证失败',
                    validators: {
                        notEmpty: {
                            message: '手机号码不能为空'
                        },
                        stringLength: {
                            min: 11,
                            max: 11,
                            message: '手机号码必须是11位数'
                        }

                    }
                }
            }
        });
        $(function () {
            var $thisA = $('a[href="/user/findCollections"]');
            $thisA.parent().attr("class", "active");
            $thisA.parent().parent().attr("class", "nav nav-second-level collapse in");
        });

    });
</script>
</body>
</html>